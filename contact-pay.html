<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0" />
    <title>Cash App Payment</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link rel="manifest" href="manifest.json" />
    <style>
      @font-face { font-family: "CashMarket"; src: url(font/CashSans.ttf); font-display: swap; }
      :root { --accent-green: #00d54b; --text-primary: #000000; --text-secondary: #6c757d; --border-color-light: #cfcfcf; }
      * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
      html, body { height: 100%; overflow: hidden; background-color: #000; }
      @keyframes slideUpFull { 0% { transform: translateY(100%); } 100% { transform: translateY(0); } }
      body { font-family: "CashMarket", -apple-system, sans-serif; color: var(--text-primary); }
      .container { max-width: 420px; margin: 0 auto; height: 100%; background-color: #ffffff; display: flex; flex-direction: column; position: relative; animation: slideUpFull 0.55s cubic-bezier(0.165, 0.84, 0.44, 1) forwards; }
      
      .fixed-top-content { background-color: #ffffff; position: relative; z-index: 10; padding: 0 20px; flex-shrink: 0; }
      .header { display: flex; justify-content: space-between; align-items: center; padding: 16px 0; position: relative; }
      .header::after { content: ""; position: absolute; bottom: -1px; left: 0; right: 0; height: 1px; background-color: var(--border-color-light); }
      .close-btn { background: none; border: none; color: var(--text-primary); font-size: 44px; font-weight: 300; cursor: pointer; line-height: 1; }
      .amount { font-size: 19px; font-weight: 600; display: flex; align-items: center; gap: 4px; }
      .amount::after { content: "\f058"; font-family: "Font Awesome 6 Free"; font-weight: 900; color: var(--accent-green); font-size: 14px; margin-left: 2px; }
      
      .pay-btn { background-color: #f2f2f7; color: #bcbcc0; border: none; padding: 8px 22px; border-radius: 20px; font-size: 16px; font-weight: 600; cursor: not-allowed; transition: all 0.2s; font-family: "CashMarket", sans-serif; }
      .pay-btn.active { background-color: var(--accent-green); color: #ffffff; cursor: pointer; }

      .input-group { display: flex; align-items: center; border-bottom: 1px solid var(--border-color-light); padding: 18px 0; }
      .input-label { color: var(--text-primary); font-size: 17px; font-weight: 600; min-width: 45px; }
      .input-field { font-family: "CashMarket", sans-serif; flex: 1; background: transparent; border: none; color: var(--text-primary); font-size: 17px; outline: none; }
      .note-icon img { width: 34px; height: 34px; }

      .payment-method { display: flex; align-items: center; justify-content: space-between; width: 100%; }
      .payment-left { display: flex; align-items: center; gap: 4px; }
      .cash-app-icon img { width: 26px; height: 26px; }
      .balance-info { color: var(--text-primary); font-size: 15px; font-weight: 600; }
      .chevron { color: #c7c7cc; font-size: 16px; padding-right: 5px; }

      .suggested-title { font-size: 24px; font-weight: 700; margin: 20px 0 10px 0; }
      .scrollable-content { flex-grow: 1; overflow-y: auto; padding: 0 16px; }
      
      /* CONTACT ITEM WITH TICK BOX */
      .contact-item { display: flex; align-items: center; padding: 18px 3px; cursor: pointer; justify-content: space-between; }
      .contact-details { display: flex; align-items: center; gap: 14px; }
      .avatar { width: 54px; height: 54px; border-radius: 50%; overflow: hidden; background-color: #eee; }
      .avatar img { width: 100%; height: 100%; object-fit: cover; }
      .contact-info { display: flex; flex-direction: column; }
      .contact-name { font-size: 18px; font-weight: 600; }
      .contact-handle { color: var(--text-secondary); font-size: 15px; }
      .tick-box { color: #e1e1e1; font-size: 22px; transition: color 0.2s; }
      .contact-item.selected .tick-box { color: var(--accent-green); }

      #search-loader { display: none; text-align: center; padding: 20px; }
      .spinner-small { width: 35px; height: 35px; animation: spin 1s linear infinite; }
      @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
      #loading-overlay { position: fixed; inset: 0; background: #fff; display: none; justify-content: center; align-items: center; z-index: 9999; }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="fixed-top-content">
        <header class="header">
          <button class="close-btn">Ã—</button>
          <div class="amount">$53,936.23</div>
          <button class="pay-btn" id="payBtn">Pay</button>
        </header>
        <div class="input-group">
          <label class="input-label">To</label>
          <input type="text" id="toInput" class="input-field" placeholder="Name, $Cashtag, Phone, Email" autocomplete="off" />
        </div>
        <div class="input-group">
          <label class="input-label">For</label>
          <input type="text" id="forInput" class="input-field" placeholder="Note (required)" autocomplete="off" />
          <div class="note-icon"><img src="gemy.png" /></div>
        </div>
        <div class="input-group">
          <div class="payment-method">
            <div class="payment-left">
              <span class="input-label">Use</span>
              <div class="cash-app-icon"><img src="kashapp.png"></div>
              <div class="balance-info">Cash balance: $53,936.23</div>
            </div>
            <div class="chevron"><i class="fas fa-chevron-down"></i></div>
          </div>
        </div>
        <h2 class="suggested-title" id="list-header">Suggested</h2>
      </div>

      <div class="scrollable-content">
        <div id="search-loader"><img src="spinergren.png" class="spinner-small" /></div>
        <div id="contactList" class="contact-list"></div>
      </div>
    </div>

    <div id="loading-overlay"><img src="spinergren.png" class="spinner-small" style="width:50px; height:50px;"/></div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const toInput = document.getElementById("toInput");
        const forInput = document.getElementById("forInput");
        const payBtn = document.getElementById("payBtn");
        const contactList = document.getElementById("contactList");
        const listHeader = document.getElementById("list-header");
        const loader = document.getElementById("search-loader");

        const recentPayments = [
          { name: "John Doe", handle: "johnd", pfp: "https://i.pravatar.cc/150?u=1", type: "cash" },
          { name: "Sarah Smith", handle: "sarahs", pfp: "https://i.pravatar.cc/150?u=2", type: "cash" },
          { name: "Alex Wong", handle: "alexw", pfp: "https://i.pravatar.cc/150?u=3", type: "cash" },
          { name: "Mike Ross", handle: "miker", pfp: "https://i.pravatar.cc/150?u=4", type: "cash" },
          { name: "Rachel Zane", handle: "rachelz", pfp: "https://i.pravatar.cc/150?u=5", type: "cash" }
        ];

        const renderItems = (users) => {
          contactList.innerHTML = users.map(user => `
            <div class="contact-item" onclick="selectUser(this, '${user.name}', '${user.handle}')">
              <div class="contact-details">
                <div class="avatar"><img src="${user.pfp}" onerror="this.src='https://ui-avatars.com/api/?name=${user.handle}&background=random'"></div>
                <div class="contact-info">
                  <span class="contact-name">${user.name}</span>
                  <span class="contact-handle">${user.type === 'cash' ? '$' : '@'}${user.handle}</span>
                </div>
              </div>
              <div class="tick-box"><i class="fa-solid fa-circle-check"></i></div>
            </div>
          `).join('');
        };

        const showSuggested = () => { listHeader.innerText = "Suggested"; renderItems(recentPayments); };
        showSuggested();

        let searchTimer;
        toInput.addEventListener("input", () => {
          const val = toInput.value.trim().replace(/[@$]/g, '');
          updatePayState();
          if (!val) { loader.style.display = "none"; showSuggested(); return; }
          listHeader.innerText = "Search Results"; contactList.innerHTML = ""; loader.style.display = "block";
          clearTimeout(searchTimer);
          searchTimer = setTimeout(() => {
            loader.style.display = "none";
            renderItems([
              { name: val, handle: val, pfp: `https://cash.app/qr/$${val}?size=120`, type: 'cash' },
              { name: val, handle: val, pfp: `https://ui-avatars.com/api/?name=${val}&background=010101&color=fff`, type: 'tiktok' }
            ]);
          }, 600);
        });

        window.selectUser = (el, name, handle) => {
          document.querySelectorAll('.contact-item').forEach(i => i.classList.remove('selected'));
          el.classList.add('selected');
          toInput.value = name;
          toInput.dataset.selectedHandle = handle;
          updatePayState();
        };

        function updatePayState() {
          payBtn.classList.toggle("active", toInput.value.trim().length > 0 && forInput.value.trim().length > 0);
        }

        forInput.addEventListener("input", updatePayState);

        payBtn.onclick = () => {
          if (!payBtn.classList.contains("active")) return;
          const data = { name: toInput.value, cashtag: toInput.dataset.selectedHandle || toInput.value };
          localStorage.setItem("pendingRecipientData", JSON.stringify(data));
          localStorage.setItem("pendingPaymentMessage", forInput.value);
          document.getElementById("loading-overlay").style.display = "flex";
          setTimeout(() => window.location.href = "payment-result.html", 2000);
        };
      });
    </script>
  </body>
</html>